<html>
    <head>
        <title>
            Profile 
        </title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
        <link rel="stylesheet" href="profile.css">
      </head>
      <body>

        <nav> MY PROFILE </nav>
      
      <div class="container">
        <h2>PROFILE</h2>
        <button onclick="Logout();" style="float: right;">Logout</button>
      
        <h3>Welcome</h3>
        <h4>IME: <script>document.write(localStorage.getItem('name'));</script></h4>
        <h4>PREZIME: <script>document.write(localStorage.getItem('surname'));</script></h4>
        <h4>TIP KORISNIKA: <script>document.write(localStorage.getItem('userType'));</script></h4>
        <h4 id="displayvrstavozila">VRSTA VOZILA: <script>document.write(localStorage.getItem('instructorvrstavozila') || 'Not Set');</script></h4>
        <h4 id="displayregoznaka">REGISTRACIJSKA OZNAKA: <script>document.write(localStorage.getItem('instructorregoznaka') || 'Not Set');</script></h4>
        <h4 id="displayiskustvo">ISKUSTVO: <script>document.write(localStorage.getItem('instructoriskustvo') || 'Not Set');</script></h4>
        <h4 id="displaydostupnost">DOSTUPNOST: <script>document.write(localStorage.getItem('instructordostupnost') || 'Not Set');</script></h4>
        <h4 id="ocjena">OCJENA: <span class="fa fa-star checked"></span>
          <span class="fa fa-star checked"></span>
          <span class="fa fa-star checked"></span>
          <span class="fa fa-star checked"></span>
          <span class="fa fa-star"></span></h4>

        <script>
          function refreshKandidatList() {
  let instructorEmail = localStorage.getItem('email');
  user_records = JSON.parse(localStorage.getItem("users")) || [];
  let instructorsData = user_records.find((user) => user.email === instructorEmail);

  if (instructorsData && instructorsData.kandidati) {
    let candidateLinks = instructorsData.kandidati.map(function (candidateEmail, index) {
      return `<a href="javascript:void(0);" onclick="viewDriverProfile('${candidateEmail}'); displayInstructorName('${instructorEmail}');">${index + 1}. ${candidateEmail}</a>`;
    });
    document.getElementById("displaykandidat").innerHTML = `Prikaz kandidata: ${candidateLinks.join("<br>") || 'Not Set'}`;
  } else {
    document.getElementById("displaykandidat").innerHTML = 'Prikaz kandidata: Not Set';
  }
}

          // Call the function to initially display the data
          refreshKandidatList();
        </script>        
        <h4 id="displaykandidat">Prikaz kandidata:</h4>
<script>
  // Call the function to initially display the data
  refreshKandidatList();
</script>

        
  
      </div>

      <div id="botuni">
        <button class="uredi" onclick="displayEditForm()">Uredi profil</button>
        <button class="dodaj" onclick="displayEditForm2()">Dodaj kandidata</button>
        <!-- <button class="button" onClick="location.href='chat/chat.html'" >Chat</button> -->
      </div>
      
      
      
      <div id="editForm" style="display: none;">

        <label for="vrstavozila">Vrsta vozila:</label>
        <input type="text" class="form-control" id="vrstavozila" placeholder="Unesite vrstu vozila">

        <label for="regoznaka">Registracijska oznaka:</label>
        <input type="text" class="form-control" id="regoznaka" placeholder="Unesite broj registracijske oznake">
        
        <label for="iskustvo">Iskustvo:</label>
        <input type="text" class="form-control" id="iskustvo" placeholder="Unesite iskustvo">

        <label for="dostupnost">Dostupnost:</label>
        <input type="text" class="form-control" id="dostupnost" placeholder="Unesite dostupnost">

        <button onclick="spremiFormu()">Spremi</button>
      </div>


        <div id="editForm2" style="display: none;">
          <select class="form-control" id="kandidat">
            <!-- Populate the dropdown with candidate emails -->
            <script>
              let user_records = JSON.parse(localStorage.getItem("users")) || [];
              let candidateOptions = user_records
                .filter((user) => user.userType === "kandidat")
                .map((candidate) => `<option value="${candidate.email}">${candidate.email}</option>`);
              document.write(candidateOptions.join(""));
            </script>
          </select>
          <button onclick="addDriverToInstructor()">Spremi</button>
      </div>

      </body>
      <script>
        let name = localStorage.getItem('name') ? localStorage.getItem('name') : '';
        let surname = localStorage.getItem('surname') ? localStorage.getItem('surname') : '';
        let userType = localStorage.getItem("userType") ? localStorage.getItem('userType') : '';
      
        console.log("User Type Set:", userType);
      
        console.log(name);
        console.log(surname);
        if (name == '') {
          alert('you need to login first');
          window.location.href = "prijava.html";
        }
      
        function displayEditForm() {
          document.getElementById("editForm").style.display = "block";
        }
      
        function displayEditForm2() {
          document.getElementById("editForm2").style.display = "block";
        }
      
        function spremiFormu() {
          let regoznaka = document.getElementById("regoznaka").value;
          let vrstavozila = document.getElementById("vrstavozila").value;
          let iskustvo = document.getElementById("iskustvo").value;
          let dostupnost = document.getElementById("dostupnost").value;

          // Provjera da li su sva polja popunjena
          if (!regoznaka || !vrstavozila || !iskustvo || !dostupnost) {
            alert("Molimo popunite sva polja");
            return;
          }
      
          // Provjera da li je iskustvo brojčani tip
          if (isNaN(iskustvo)) {
            alert("Iskustvo mora biti broj");
            return;
          }
      
          localStorage.setItem("instructorregoznaka", regoznaka);
          document.getElementById("displayregoznaka").innerText = `Registracijska oznaka: ${regoznaka}`;
      
          localStorage.setItem("instructorvrstavozila", vrstavozila);
          document.getElementById("displayvrstavozila").innerText = `Vrsta vozila: ${vrstavozila}`;
      
          localStorage.setItem("instructoriskustvo", iskustvo);
          document.getElementById("displayiskustvo").innerText = `Iskustvo: ${iskustvo}`;
      
          localStorage.setItem("instructordostupnost", dostupnost);
          document.getElementById("displaydostupnost").innerText = `Dostupnost: ${dostupnost}`;
      
          document.getElementById("editForm").style.display = "none";
        }
      
        function addDriverToInstructor() {
          let instructorEmail = localStorage.getItem('email');
          let candidateEmail = document.getElementById("kandidat").value;
          let user_records = JSON.parse(localStorage.getItem("users")) || [];
          let instructorsData = user_records.find((user) => user.email === instructorEmail);
      
          if (instructorsData) {
            if (instructorsData.kandidati && instructorsData.kandidati.includes(candidateEmail)) {
              alert("Kandidat je već dodijeljen!");
            } else {
              instructorsData.kandidati = instructorsData.kandidati || [];
              instructorsData.kandidati.push(candidateEmail);
              localStorage.setItem("users", JSON.stringify(user_records));
              alert("Kandidat je dodijeljen uspješno!");
              refreshKandidatList();
            }
          } else {
            alert("Instructor data not found!");
          }
          
        }
      
        let displayKandidatElement = document.getElementById("displaykandidat");

        displayKandidatElement.addEventListener("click", function () {
          let selectedCandidatesList = displayKandidatElement.querySelectorAll("a");
          let candidateLinks = Array.from(selectedCandidatesList).map(function (candidateLink) {
            return `<a href="javascript:void(0);" onclick="${candidateLink.getAttribute('onclick')}">${candidateLink.innerHTML}</a>`;
          });
    
          displayKandidatElement.innerHTML = `Prikaz kandidata: ${candidateLinks.join("<br>") || 'Not Set'}`;
        });
    
        function viewDriverProfile(driverEmail) {
          let user_records = JSON.parse(localStorage.getItem("users")) || [];
          let driverData = user_records.find((user) => user.email === driverEmail);
      
        }
        function viewDriverProfile(driverEmail) {
          // Redirect to the driver profile page with the driver's email as a parameter
          window.location.href = `profilek.html?email=${driverEmail}`;
        }

        function Logout() {
          localStorage.removeItem('name');
          localStorage.removeItem('email');
          localStorage.removeItem('userType')
          window.location.href = "prijava.html";
        }




      </script>
      
      </html>
      